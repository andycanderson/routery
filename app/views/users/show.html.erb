<h1>show trips</h1>

<%= form_for Trip.new do |f| %>
	<%= f.text_field :name, placeholder: "Enter New Trip" %>
	<%= f.submit "New Trip", :class => 'submit' %>
<% end %>

<%@trips.each do |trip|%>
	<p>trip name: <%= link_to "#{trip.name}", trip_path(trip)%></p>
    <div class="edit-button">EDIT</div>
    <div class="edit-location">
        <%=form_for trip, html: {method: "patch"} do |f|%>
        <%=f.text_field :name, value: trip.name%>
        <%=f.submit "save changes!", :class => 'submit'%>
        <%= link_to 'delete', trip, :method => :delete %>

        <%end%>
    </div>
	
<%end%>


<div id="map-canvas"></div>



<script>

var initialize = function(){

    var map;
    var elevator;
    var myOptions = {
        zoom: 1,
        center: new google.maps.LatLng(0, 0),
        // this makes terrain show
        // mapTypeId: 'terrain',
        styles: mapStyle

    };
    map = new google.maps.Map($('#map-canvas')[0], myOptions);

    // input addresses here
    var addresses = <%=@arr%>;
    var names = <%=raw @names.to_json.gsub("</", "<\\/")%>
    var descriptions = <%=raw @descriptions.to_json.gsub("</", "<\\/")%>;
    

    
    var marker = [];
    var infowindow = [];
    for (var x = 0; x < addresses.length; x++) 
    {
        var latlng = new google.maps.LatLng(addresses[x][1], addresses[x][0]);
        marker[x] = new google.maps.Marker({
            position: latlng,
            map: map
            });

        
        var contentString =  '<h1>'+names[x].toString()+'</h1>'+'<p>' + descriptions[x].toString() + '</p>';
        infowindow.push(new google.maps.InfoWindow({
            content: contentString,
            maxWidth: 100
        }));
    }

    // make clusters for markers
    var markerCluster = new MarkerClusterer(map, marker);

    // create function that's executed immediately
    function callInfoWindow(x) {
        return function() {
            infowindow[x].open(map, marker[x]);
        }
    }

    //creates all event listeners
    for(var x = 0; x < marker.length; x++)
    {
        google.maps.event.addListener(marker[x], 'click', callInfoWindow(x));
    }


 };

 // shows or hides edit forms
 $('.edit-button').click(function(){
     $(this).next(".edit-location").toggle();
 });



 $(document).ready(initialize);
 $(document).on('page:load', initialize);
</script>
